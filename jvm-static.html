<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="apple-touch-icon" sizes="180x180" href="https://i.imgur.com/2nHGFTv.png"/><link rel="icon" type="image/png" sizes="32x32" href="https://i.imgur.com/2nHGFTv.png"/><link rel="icon" type="image/png" sizes="16x16" href="https://i.imgur.com/2nHGFTv.png"/><link rel="manifest" href="/site.webmanifest"/><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#da532c"/><meta name="theme-color" content="#ffffff"/><title>Static 변수 저장위치와 JVM 구조의 변화</title><meta name="title" content="Static 변수 저장위치와 JVM 구조의 변화"/><meta name="description" content="Static 변수 저장위치와 JVM 구조의 변화"/><meta name="keywords" content="자바, jvm, 정적 변수"/><meta name="robots" content="index, follow"/><meta http-equiv="Content-Type" content="text/html; charset=utf-8"/><meta name="language" content="Korean"/><meta name="author" content="Sanha Ko"/><meta property="og:title" content="Static 변수 저장위치와 JVM 구조의 변화"/><meta property="og:url" content="https://headf1rst.github.io/TIL/jvm-static"/><meta property="og:type" content="blog"/><meta property="og:image" content="https://i.imgur.com/5AJJwhh.png"/><meta property="og:description" content="Static 변수 저장위치와 JVM 구조의 변화"/><meta name="next-head-count" content="22"/><link rel="preload" href="/TIL/_next/static/css/754b961274c075df.css" as="style"/><link rel="stylesheet" href="/TIL/_next/static/css/754b961274c075df.css" data-n-g=""/><link rel="preload" href="/TIL/_next/static/css/38994dd0aed51f22.css" as="style"/><link rel="stylesheet" href="/TIL/_next/static/css/38994dd0aed51f22.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/TIL/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/TIL/_next/static/chunks/webpack-ac557983bcc4c022.js" defer=""></script><script src="/TIL/_next/static/chunks/framework-2c79e2a64abdb08b.js" defer=""></script><script src="/TIL/_next/static/chunks/main-dc8c1543918dad35.js" defer=""></script><script src="/TIL/_next/static/chunks/pages/_app-421e211a78340d83.js" defer=""></script><script src="/TIL/_next/static/chunks/202-7f08bae5ecc79443.js" defer=""></script><script src="/TIL/_next/static/chunks/pages/%5Bid%5D-e822cf87f2ef122d.js" defer=""></script><script src="/TIL/_next/static/kp1gY2qzEskHKbCxkA_Iv/_buildManifest.js" defer=""></script><script src="/TIL/_next/static/kp1gY2qzEskHKbCxkA_Iv/_ssgManifest.js" defer=""></script></head><body><div id="__next"><nav class="flex bg-white sticky top-0 left-0 z-50 justify-between items-center border-b-2 border-gray-100 py-3 md:justify-start md:space-x-10 px-10 sm:px-5 dark:bg-[#0d1117] dark:text-[#c9d1d9] dark:border-gray-600"><div class="flex justify-start"><a href="/TIL"><div class="flex items-center gap-2 cursor-pointer"><img src="https://i.imgur.com/2nHGFTv.png" width="40" height="40" alt="블로그 아이콘"/><h1 class="text-lg ">산하개발실록</h1></div></a></div><div class="flex justify-between gap-10 sm:hidden"><a href="/TIL"><button class="font-light hover:text-indigo-300 text-base">Home</button></a><a href="/TIL/category"><button class="font-light hover:text-indigo-300 text-base">Category</button></a><a href="https://plain-composer-c65.notion.site/29c7640fdf054059b6ea28ed61189bfb" target="_blank" rel="noreferrer" class="hover:text-indigo-300 text-base font-light flex gap-1">About<span class="flex justify-center" style="align-items:center"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="m13 3 3.293 3.293-7 7 1.414 1.414 7-7L21 11V3z"></path><path d="M19 19H5V5h7l-2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2v-5l-2-2v7z"></path></svg></span></a></div><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" class="lg:hidden" height="25" width="25" xmlns="http://www.w3.org/2000/svg"><path d="M32 96v64h448V96H32zm0 128v64h448v-64H32zm0 128v64h448v-64H32z"></path></svg></nav><main class="dark:bg-[#0d1117] h-screen pb-10"><div class="flex flex-col w-3/5 sm:w-5/6 m-auto pt-20 pb-20 gap-10 dark:bg-[#0d1117] dark:text-[#c9d1d9]"><ul id="scroll-spy" class="sm:hidden p-10 fixed top-50 right-0 h-full w-1/5 text-gray-500 dark:text-[#c9d1d9]"></ul><div class="text-5xl font-bold">Static 변수 저장위치와 JVM 구조의 변화</div><div class="flex flex-col gap-2"><div class="text-base text-gray-600 dark:text-gray-300">2022-07-11 10:00</div><div class="flex flex-wrap gap-2 dark:text-black sm:m-0"><span class="p-1 pl-3 pr-3 rounded-md bg-indigo-100 hover:bg-indigo-200 cursor-pointer transition ease-in-out duration-200 text-sm">Java</span></div></div><div class="markdown-body" style="font-size:17px"><p>Static 키워드를 사용하여 정적 변수와 정적 메서드를 만들수 있는데, 이들을 정적 멤버 (혹은 클래스 멤버) 라고 합니다.</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span class="hljs-class" style="color:#a626a4">class</span><span class="hljs-class"> </span><span class="hljs-class" style="color:#4078f2">Lesson</span><span class="hljs-class"> </span><span>{
</span><span>		</span><span style="color:#a626a4">static</span><span> </span><span style="color:#a626a4">int</span><span> score = </span><span style="color:#986801">0</span><span>;
</span><span>		</span><span style="color:#a626a4">static</span><span> String grade = </span><span style="color:#50a14f">&#x27;F&#x27;</span><span>;
</span>
<span>		</span><span class="hljs-function" style="color:#a626a4">static</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#a626a4">void</span><span class="hljs-function"> </span><span class="hljs-function" style="color:#4078f2">getScore</span><span class="hljs-function hljs-params">()</span><span class="hljs-function"> </span><span>{
</span>			 ...
<!-- -->		}
<!-- -->}</code></div></pre>
<p>Lesson 클래스(Class)는 Method Area에 생성되고, new 연산을 통해 생성한 Lesson 클래스의 객체(Object)는 Heap <strong>영역</strong>에 생성됩니다.</p>
<p><img src="https://i.imgur.com/Stip2zD.png" alt="Untitled" node="[object Object]" style="max-height:450px;max-width:90%"/></p>
<p>그렇다면 정적 멤버들은 메모리상의 어느 위치에 저장이 될까요?</p>
<p>정적 멤버(클래스 멤버)는 말 그대로 객체(인스턴스)에 소속된 멤버가 아니라 클래스에 고정된 멤버입니다.</p>
<p>그렇기 때문에, 정적 멤버는 Class와 함께 클래스 로더에 의해서 <strong>Method Area</strong>에 저장되지 않을까요?</p>
<p>저의 이 생각은 Java 7까지는 맞지만 Java 8부터는 반만 맞는 대답이 되고 말았습니다.</p>
<p>왜 Java 8부터는 반만 맞는 대답인걸까요?</p>
<p>그 이유는 Java 7과 8의 JVM 구조에 변화가 있었기 때문입니다.</p>
<h2>Java 7의 HotSpot JVM 힙 그리고 static 변수</h2>
<p>Java 7 버전까지만 해도 정적 멤버들은 Method Area를 포함하고 있는  <code node="[object Object]">PermGen</code> 영역에 저장되었었습니다.</p>
<p><img src="https://i.imgur.com/TK8mAwL.png" alt="스크린샷 2022-07-16 오전 11.14.55.png" node="[object Object]" style="max-height:450px;max-width:90%"/></p>
<p>PermGen은 정적 멤버 외에도, <strong>클래스 메타 데이터, interned String이 저장되었습니다.</strong></p>
<ul>
<li>클래스 메타데이터 : 클래스의 이름, 생성정보, 필드정보, 메서드 정보 등</li>
</ul>
<p>하지만 문제는 PermGen 영역이 매우 제한적인 크기를 갖고 있다는 것이었습니다.</p>
<p>PermGen 영역의 default 크기는, 32-bit JVM에선 64M, 64-bit에선 84M에 불과합니다.</p>
<p>때문에, 클래스 로딩이 많아지게 되면 사용 가능한 메모리가 부족해서 다음과 같은 에러가 발생하고는 했습니다.</p>
<pre><div node="[object Object]" style="display:block;overflow-x:auto;padding:0.5em;color:#383a42;background:#fafafa"><code class="language-java" style="white-space:pre"><span>java.lang.OutOfMemoryError: PermGen space</span></code></div></pre>
<p>뿐만 아니라, JVM은 PermGen 영역의 사이즈를 유지시키기 위해서 주기적으로 Garbage Collection연산을 수행하게 되는데 이는 성능 이슈를 야기했습니다.</p>
<p>물론 <code node="[object Object]">-XX:PermSize</code> , <code node="[object Object]">-XX:MaxPermSize</code> 와 같은 명령어를 통해서 사용자가 직접 PermGen영역을 설정해 주는것이 가능했습니다.</p>
<p>하지만 자동으로 영역의 사이즈가 늘어나지 않았고, 매모리 가용 용량을 미리 예측해서 설정하는것은 쉽지 않은 일이었습니다.</p>
<h2>Java 8의 Hotspot JVM 그리고 static 변수</h2>
<p>이러한 문제를 해결하기 위해서 Java 8에선 PermGen 영역이 없어지고 <code node="[object Object]">MetaSpace</code> 영역이 새로 생겼습니다.</p>
<p>Metaspace 영역은 힙이 아닌 Native 메모리 영역으로 취급됩니다.</p>
<p><img src="https://i.imgur.com/4VucRG4.png" alt="스크린샷 2022-07-16 오전 11.14.20.png" node="[object Object]" style="max-height:450px;max-width:90%"/></p>
<p><a href="https://openjdk.org/jeps/122">https://openjdk.org/jeps/122</a></p>
<p>힙 영역은 JVM에 의해 관리되는 영역이지만 Native 메모리 영역은 OS 레벨에서 관리하는 영역입니다.</p>
<p>즉, Metaspace가 Native 메모리를 이용함으로써 개발자는 영역 확보의 상한을 크게 의식할 필요가 없어지게 되었습니다. (metaspace의 사이즈는 auto increase 됩니다)</p>
<p><code node="[object Object]">metaspace</code> 에서는 <strong>클래스 메타 데이터</strong>만을 저장하고 정적 멤버와 interned string은 힙에서 관리되게 되었습니다.</p>
<p>Metaspace는 클래스 메타 데이터를 native메모리에 저장하고 부족할 경우 자동으로 늘려줍니다.</p>
<p>덕분에 더이상 PermSize 설정을 고려할 필요가 없어졌고 MetaspaceSize, MaxMetaspaceSize가 새롭게 사용되게 되었습니다.</p>
<p>만약 별도의 MetaspaceSize 설정을 하지 않으면 Native memory 자원을 최대한 사용하게 됩니다.</p>
<p>(Default jvm MaxMetaspaceSize = None)</p>
<h2>결론</h2>
<p>요약하자면, Java 7에서는 정적 멤버 변수가 PermGen(Method Area)에 저장되었습니다.</p>
<p>하지만 메모리 관리상의 문제로 인해 PermGen 영역이 사라지고 Metaspace 영역이 등장하면서, 정적 멤버 변수는 힙에 저장이 되도록 변경 되었습니다.</p>
<p><strong>참고 자료</strong></p>
<p><a href="https://openjdk.org/jeps/122">JEP 122: Remove the Permanent Generation</a></p>
<p><a href="https://stackoverflow.com/questions/8387989/where-are-static-methods-and-static-variables-stored-in-java">Where are static methods and static variables stored in Java?</a></p>
<p><a href="https://blog.voidmainvoid.net/315">Java PermGen의 역사</a></p>
<p><a href="https://77loopin.github.io/java/Java-1/">Hotspot JVM의 힙 구조</a></p>
<p><a href="https://www.geeksforgeeks.org/metaspace-in-java-8-with-examples/#:~:text=Method%20Area%20is%20a%20part,which%20leads%20to%20an%20OutOfMemoryError">https://www.geeksforgeeks.org/metaspace-in-java-8-with-examples/#:~:text=Method Area is a part,which leads to an OutOfMemoryError</a>.</p></div><section></section></div></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"jvm-static","title":"Static 변수 저장위치와 JVM 구조의 변화","category":"JAVA","thumbnail":"https://i.imgur.com/5AJJwhh.png","tags":"Java","date":"2022-07-11 10:00","searchKeywords":"자바, jvm, 정적 변수","description":"Static 변수 저장위치와 JVM 구조의 변화","preview":"\nStatic 키워드를 사용하여 정적 변수와 정적 메서드를 만들수 있는데, 이들을 정적 멤버 (혹은 클래스 멤버) 라고 합니다.\n\n```java\nclass Lesson {\n\t\tstatic int score = 0;\n\t\tstatic String grad"},"detail":"\nStatic 키워드를 사용하여 정적 변수와 정적 메서드를 만들수 있는데, 이들을 정적 멤버 (혹은 클래스 멤버) 라고 합니다.\n\n```java\nclass Lesson {\n\t\tstatic int score = 0;\n\t\tstatic String grade = 'F';\n\n\t\tstatic void getScore() {\n\t\t\t ...\n\t\t}\n}\n```\n\nLesson 클래스(Class)는 Method Area에 생성되고, new 연산을 통해 생성한 Lesson 클래스의 객체(Object)는 Heap **영역**에 생성됩니다.\n\n![Untitled](https://i.imgur.com/Stip2zD.png)\n\n그렇다면 정적 멤버들은 메모리상의 어느 위치에 저장이 될까요?\n\n정적 멤버(클래스 멤버)는 말 그대로 객체(인스턴스)에 소속된 멤버가 아니라 클래스에 고정된 멤버입니다. \n\n그렇기 때문에, 정적 멤버는 Class와 함께 클래스 로더에 의해서 **Method Area**에 저장되지 않을까요?\n\n저의 이 생각은 Java 7까지는 맞지만 Java 8부터는 반만 맞는 대답이 되고 말았습니다.\n\n왜 Java 8부터는 반만 맞는 대답인걸까요?\n\n그 이유는 Java 7과 8의 JVM 구조에 변화가 있었기 때문입니다.\n\n## Java 7의 HotSpot JVM 힙 그리고 static 변수\n\nJava 7 버전까지만 해도 정적 멤버들은 Method Area를 포함하고 있는  `PermGen` 영역에 저장되었었습니다.\n\n![스크린샷 2022-07-16 오전 11.14.55.png](https://i.imgur.com/TK8mAwL.png)\n\nPermGen은 정적 멤버 외에도, **클래스 메타 데이터, interned String이 저장되었습니다.**\n\n- 클래스 메타데이터 : 클래스의 이름, 생성정보, 필드정보, 메서드 정보 등\n\n하지만 문제는 PermGen 영역이 매우 제한적인 크기를 갖고 있다는 것이었습니다.\n\nPermGen 영역의 default 크기는, 32-bit JVM에선 64M, 64-bit에선 84M에 불과합니다.\n\n때문에, 클래스 로딩이 많아지게 되면 사용 가능한 메모리가 부족해서 다음과 같은 에러가 발생하고는 했습니다.\n\n```java\njava.lang.OutOfMemoryError: PermGen space\n```\n\n뿐만 아니라, JVM은 PermGen 영역의 사이즈를 유지시키기 위해서 주기적으로 Garbage Collection연산을 수행하게 되는데 이는 성능 이슈를 야기했습니다.\n\n물론 `-XX:PermSize` , `-XX:MaxPermSize` 와 같은 명령어를 통해서 사용자가 직접 PermGen영역을 설정해 주는것이 가능했습니다.\n\n하지만 자동으로 영역의 사이즈가 늘어나지 않았고, 매모리 가용 용량을 미리 예측해서 설정하는것은 쉽지 않은 일이었습니다.\n\n## Java 8의 Hotspot JVM 그리고 static 변수\n\n이러한 문제를 해결하기 위해서 Java 8에선 PermGen 영역이 없어지고 `MetaSpace` 영역이 새로 생겼습니다.\n\nMetaspace 영역은 힙이 아닌 Native 메모리 영역으로 취급됩니다.\n\n![스크린샷 2022-07-16 오전 11.14.20.png](https://i.imgur.com/4VucRG4.png)\n\n[https://openjdk.org/jeps/122](https://openjdk.org/jeps/122)\n\n힙 영역은 JVM에 의해 관리되는 영역이지만 Native 메모리 영역은 OS 레벨에서 관리하는 영역입니다.\n\n즉, Metaspace가 Native 메모리를 이용함으로써 개발자는 영역 확보의 상한을 크게 의식할 필요가 없어지게 되었습니다. (metaspace의 사이즈는 auto increase 됩니다)\n\n`metaspace` 에서는 **클래스 메타 데이터**만을 저장하고 정적 멤버와 interned string은 힙에서 관리되게 되었습니다.\n\nMetaspace는 클래스 메타 데이터를 native메모리에 저장하고 부족할 경우 자동으로 늘려줍니다.\n\n덕분에 더이상 PermSize 설정을 고려할 필요가 없어졌고 MetaspaceSize, MaxMetaspaceSize가 새롭게 사용되게 되었습니다. \n\n만약 별도의 MetaspaceSize 설정을 하지 않으면 Native memory 자원을 최대한 사용하게 됩니다.\n\n(Default jvm MaxMetaspaceSize = None)\n\n## 결론\n\n요약하자면, Java 7에서는 정적 멤버 변수가 PermGen(Method Area)에 저장되었습니다.\n\n하지만 메모리 관리상의 문제로 인해 PermGen 영역이 사라지고 Metaspace 영역이 등장하면서, 정적 멤버 변수는 힙에 저장이 되도록 변경 되었습니다.\n\n**참고 자료**\n\n[JEP 122: Remove the Permanent Generation](https://openjdk.org/jeps/122)\n\n[Where are static methods and static variables stored in Java?](https://stackoverflow.com/questions/8387989/where-are-static-methods-and-static-variables-stored-in-java)\n\n[Java PermGen의 역사](https://blog.voidmainvoid.net/315)\n\n[Hotspot JVM의 힙 구조](https://77loopin.github.io/java/Java-1/)\n\n[https://www.geeksforgeeks.org/metaspace-in-java-8-with-examples/#:~:text=Method Area is a part,which leads to an OutOfMemoryError](https://www.geeksforgeeks.org/metaspace-in-java-8-with-examples/#:~:text=Method%20Area%20is%20a%20part,which%20leads%20to%20an%20OutOfMemoryError).\n"},"__N_SSG":true},"page":"/[id]","query":{"id":"jvm-static"},"buildId":"kp1gY2qzEskHKbCxkA_Iv","assetPrefix":"/TIL","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>